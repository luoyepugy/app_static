function da_input(a){var b=$("#name").val(),c=$("#start_time").val(),d=$("#end_time").val(),e=new Date($("#start_time").val()).getTime(),f=new Date($("#end_time").val()).getTime(),g=$("#city").val(),h=$("#address").val(),i=$("#type").val(),j=$("#type").attr("data-id"),k=$("#details").val(),l=$("#industry").attr("data-id"),m=$("#industry").val(),n=$("#contact_way").val(),o=$("#sponsor").val(),p={};p.name=b,p.start_time=e,p.end_time=f,p.city=$("#city").attr("data-id"),p.address=h,p.type=j,p.details=k,p.industry_id=l,p.contact_way=n,p.sponsor=o;var q={};if(1==a){if(!form_mm.isnull(b))return void mui.alert("请输入活动标题","E场景活动",function(){$("#name").focus()});if(!form_mm.isnull(b))return void mui.alert("请选择活动开始时间","E场景活动",function(){$("#start_time").click()});if(!form_mm.isnull(d))return void mui.alert("请选择活动结束时间","E场景活动",function(){$("#end_time").click()});if(f<(new Date).getTime())return void mui.alert("活动结束时间不能小余当前时间","E场景活动",function(){$("#end_time").focus()});if(!form_mm.isnull(g))return void mui.alert("请选择活动城市","E场景活动",function(){$("#city").click()});if(!form_mm.isnull(h))return void mui.alert("请输入详细地址","E场景活动",function(){$("#address").focus()});if(!form_mm.isnull(i))return void mui.alert("请选择行业","E场景活动",function(){$("#industry").focus()});if(!form_mm.isnull(m))return void mui.alert("请选择行业","E场景活动",function(){$("#industry").focus()});if(!form_mm.isnull(k))return void mui.alert("请输入活动详情","E场景活动",function(){$("#details").focus()});if(!form_mm.isnull(n))return void mui.alert("请输入联系方式","E场景活动",function(){$("#contact_way").focus()});if(!form_mm.isnull(o))return void mui.alert("请输入主办方","E场景活动",function(){$("#sponsor").focus()});$(".sys-loading").addClass("show_a")}else 2==a&&(p.s_time=c,p.e_time=d,p.city_m=g,p.type_m=i);return q.activity=p,q}function input_val(a){$("#name").val(a.name),$("#start_time").val(a.s_time),$("#end_time").val(a.e_time),form_mm.isnull($("#start_time").val())&&$("#start_time").attr("data-id",new Date($("#start_time").val()).getTime()),form_mm.isnull($("#end_time").val())&&$("#end_time").attr("data-id",new Date($("#end_time").val()).getTime()),$("#city").val(a.city_m),form_mm.isnull($("#end_time").val())&&$("#city").attr("data-id",a.city),$("#address").val(a.address),$("#type").val(a.type_m),form_mm.isnull($("#type").val())&&$("#type").attr("data-id",a.type),$("#details").val(a.details)}function classify_p(){var a=[{title:"分类",maker_title:[{id:"0",text:"全部"},{id:"1",text:"路演场馆"},{id:"2",text:"置业装修"},{id:"3",text:"汽车活动"},{id:"5",text:"商家促销"},{id:"6",text:"精品课程"},{id:"7",text:"户外运动"},{id:"9",text:"保险投资"}]},{title:"行业",maker_title:[{id:"0",text:"全部"},{id:"1",text:"孵化器"},{id:"2",text:"房产"},{id:"3",text:"互联网"},{id:"4",text:"公益"},{id:"5",text:"培训"},{id:"6",text:"汽车"},{id:"7",text:"旅游"},{id:"8",text:"酒店"},{id:"9",text:"家装"},{id:"10",text:"卖场"},{id:"11",text:"明星"},{id:"12",text:"商会"},{id:"13",text:"社区"},{id:"14",text:"展会"},{id:"15",text:"大健康"},{id:"16",text:"校园"},{id:"17",text:"媒体"},{id:"18",text:"趣味"},{id:"19",text:"金融"},{id:"20",text:"其他"}]},{title:"城市",maker_title:[{id:"1",text:"北京 "},{id:"2",text:"天津 "},{id:"3",text:"上海 "},{id:"4",text:"重庆 "},{id:"51",text:"大连 "},{id:"86",text:"南京 "},{id:"99",text:"杭州 "},{id:"128",text:"厦门 "},{id:"418",text:"武汉 "},{id:"435",text:"长沙 "},{id:"449",text:"广州 "},{id:"450",text:"深圳 "},{id:"556",text:"西安 "},{id:"627",text:"香港特别行政区"}]},{title:"时间",maker_title:[{id:"0",text:"不限"},{id:"1",text:"明天"},{id:"2",text:"近7天"},{id:"3",text:"一个月"}]},{title:"收费类型",maker_title:[{id:"",text:"不限"},{id:"1",text:"免费"},{id:"2",text:"收费"}]}];return a}function onBridgeReady(a,b){WeixinJSBridge.invoke("getBrandWCPayRequest",a,function(a){"get_brand_wcpay_request：ok"==a.err_msg&&b()})}function wx_share(a,b){var c=window.location.href;$.ajax({type:"get",url:"/WxShare/wxshareParam",data:{shareUrl:c},contentType:"application/json;charset=UTF-8",dataType:"json",success:function(c){var d=c;jssdkconfig={appId:"wxca4f9653c04f3e8d",nonceStr:d.info[0].nonceStr,timestamp:d.info[0].timestamp,signature:d.info[0].signature}||{jsApiList:[]},console.log(d+"  "+d.info[0].nonceStr+"  "+d.info[0].timestamp+"  "+d.info[0].signature),jssdkconfig.jsApiList=["checkJsApi","onMenuShareTimeline","onMenuShareAppMessage","onMenuShareQQ","onMenuShareWeibo","showOptionMenu"],wx.config(jssdkconfig),sharedata=a,wx.ready(function(){wx.showOptionMenu(),wx.onMenuShareAppMessage(sharedata),wx.onMenuShareTimeline(sharedata),wx.onMenuShareQQ(sharedata),wx.onMenuShareWeibo(sharedata);try{b()}catch(a){}})},error:function(a){console.log("请求失败")}})}function share_p(a){var b=(new RegExp("\n","g"),{url:"http://m.apptown.cn/activity/activityShowSkip?activity_id="+a,title:$("title").text(),pics:"http://m.apptown.cn/img/activity/share/share_activity1.jpg",details_a:"e场景活动",Qzone:function(){var a={url:this.url,showcount:"1",desc:"这活动我太喜欢了",summary:this.details_a,title:this.title,site:"e场景活动吧",pics:this.pics,style:"101",width:199,height:30},b=[];for(var c in a)b.push(c+"="+encodeURIComponent(a[c]||""));window.location.href="http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?"+b.join("&")},qq:function(){var a={url:this.url,desc:"这活动我太喜欢了",title:this.title,summary:this.details_a,pics:this.pics,flash:"",site:"e场景活动吧",style:"201",width:32,height:32},b=[];for(var c in a)b.push(c+"="+encodeURIComponent(a[c]||""));window.location.href="http://connect.qq.com/widget/shareqq/index.html?"+b.join("&")},qqweibo:function(){window.location.href="http://share.v.t.qq.com/index.php?c=share&a=index&url="+this.url+"&title="+this.title+"&site=&pic="+this.pics+"&appkey=1103378751'"}});return b}function removeHTMLTag(a){return a=a.replace(/<\/?[^>]*>/g,""),a=a.replace(/[ | ]*\n/g,"\n"),a=a.replace(/ /gi,"")}angular.module("ticket_volume_list",["directive_mml","activity_servrt","ui.router","pay","sponsor","act_details","router"]).controller("mode_Controller",["$scope","activity_data","$location",function(a,b,c){a.classify=[{title:"分类",maker_title:[{id:"0",name:"全部"},{id:"1",name:"路演场馆"},{id:"2",name:"置业装修"},{id:"3",name:"汽车活动"},{id:"5",name:"商家促销"},{id:"6",name:"精品课程"},{id:"7",name:"户外运动"},{id:"9",name:"保险投资"}]},{title:"行业",maker_title:[{id:"0",name:"全部"},{id:"1",name:"孵化器"},{id:"2",name:"房产"},{id:"3",name:"互联网"},{id:"4",name:"公益"},{id:"5",name:"培训"},{id:"6",name:"汽车"},{id:"7",name:"旅游"},{id:"8",name:"酒店"},{id:"9",name:"家装"},{id:"10",name:"卖场"},{id:"11",name:"明星"},{id:"12",name:"商会"},{id:"13",name:"社区"},{id:"14",name:"展会"},{id:"15",name:"大健康"},{id:"16",name:"校园"},{id:"17",name:"媒体"},{id:"18",name:"趣味"},{id:"19",name:"金融"},{id:"20",name:"其他"}]},{title:"城市",maker_title:[{id:"1",name:"北京 "},{id:"2",name:"天津 "},{id:"3",name:"上海 "},{id:"4",name:"重庆 "},{id:"51",name:"大连 "},{id:"86",name:"南京 "},{id:"99",name:"杭州 "},{id:"128",name:"厦门 "},{id:"418",name:"武汉 "},{id:"435",name:"长沙 "},{id:"449",name:"广州 "},{id:"450",name:"深圳 "},{id:"556",name:"西安 "},{id:"627",name:"香港特别行政区"}]},{title:"时间",maker_title:[{id:"0",name:"不限"},{id:"1",name:"明天"},{id:"2",name:"近7天"},{id:"3",name:"一个月"}]},{title:"收费类型",maker_title:[{id:"",name:"不限"},{id:"1",name:"免费"},{id:"2",name:"收费"}]}],a.classification={title:"行业",maker_title:[{id:"0",name:"全部"},{id:"1",name:"孵化器"},{id:"2",name:"房产"},{id:"3",name:"互联网"},{id:"4",name:"公益"},{id:"5",name:"培训"},{id:"6",name:"汽车"},{id:"7",name:"旅游"},{id:"8",name:"酒店"},{id:"9",name:"家装"},{id:"10",name:"卖场"},{id:"11",name:"明星"},{id:"12",name:"商会"},{id:"13",name:"社区"},{id:"14",name:"展会"},{id:"15",name:"大健康"},{id:"16",name:"校园"},{id:"17",name:"媒体"},{id:"18",name:"趣味"},{id:"19",name:"金融"},{id:"20",name:"其他"}]},a.decrypt_p={aesKey:"1234367822345608",ivStr:"1166222233334455",newAesKey:null,aesEncrypt:function(a,b,c){var d=CryptoJS.enc.Utf8.parse(a),e=CryptoJS.enc.Utf8.parse(b),f=CryptoJS.enc.Utf8.parse(c),g=CryptoJS.AES.encrypt(d,e,{iv:f,mode:CryptoJS.mode.CBC});return g.toString()}},$(".menu_pup li").on("click",function(){$(".menu_pup").toggleClass("show_a")}),a.open_p=function(a){open(a)},a.city_name=void 0==localStorage.city_name?"深圳":localStorage.city_name}]).controller("index_controller",["$scope","activity_data",function(a,b){$(".mml_bottom a").removeClass("bottom_act"),$(".mml_bottom a").eq(0).addClass("bottom_act"),$(".ds_poiu_a").addClass("show_a"),$(".retreat_icon").addClass("none"),a.act_index={banner_index:[],activity_hot:[],activity_sum:{}};new Swiper(".banner_top_b_banner",{autoplay:3e3,observer:!0,observeParents:!0,pagination:".swiper-pagination",paginationClickable:!0});b.banner_index().then(function(b){return 0!=b.code?void console.log(b.msg):void $(b.info).map(function(){if(null!=this.activity_banner_url){var b=new indexbanner(this.activity_id,this.activity_banner_url);a.act_index.banner_index.push(b)}})},function(){console.log("获取轮播图失败")}),b.activityIndex().then(function(b){a.act_index.activity_sum=new activity_sum(b.info)},function(){console.log("获取热门活动失败")}),b.getActivityHot().then(function(b){return 0!=b.code?void console.log(b.msg):void $(b.info).map(function(){var b=new preferential(this);a.act_index.activity_hot.push(b)})},function(){console.log("获取热门活动失败")}),$(".mml_bottom ").show();var c={};c.title="【首页】e场景活动",c.desc='便捷的活动众筹发布平台、"找活动,上e场景活动平台"',c.link="http://m.apptown.cn",c.imgUrl="http://m.apptown.cn/img/mml_log.jpg",wx_share(c)}]).controller("activities_list",["$scope","activity_data","$stateParams",function(a,b,c){function d(){setTimeout(function(){h=!0,++g.pageIndex,a.act_list.act_list_data(g)},1500)}$(".mml_bottom ").show(),$(".mml_bottom a").removeClass("bottom_act"),$(".mml_bottom a").eq(0).addClass("bottom_act"),$(".ds_poiu_a").removeClass("show_a"),$(".retreat_icon").removeClass("none");var e="创客",f=parseInt(c.activityTypeId);switch(f){case 1:e="路演场馆";break;case 2:e="置业装修";break;case 3:e="汽车活动";break;case 9:e="商家促销";break;case 5:e="精品课程";break;case 6:e="户外运动";break;case 7:e="商品促销";break;case 0:e="全部"}$(".sys-loading").addClass("show_a"),$(".list_activities .box_a").eq(0).find("span").text(e);var g={};g.name="",g.type=f,g.cityId="",g.freeType="",g.industryId="",g.pageIndex=1,g.pageSize=7,g.time_status="",g.status=0,a.act_list={activity_list:[],select_data:[],title_p:function(b,c){switch($(".list_active").addClass("show_a"),b){case 1:a.act_list.select_data=a.classify[0];break;case 2:a.act_list.select_data=a.classify[1];break;case 3:a.act_list.select_data=a.classify[3];break;case 4:a.act_list.select_data=a.classify[4]}},se_function:function(b,c,d){switch($(".sys-loading").addClass("show_a"),a.act_list.activity_list=[],g.pageIndex=1,$(".list_active").removeClass("show_a"),b){case"分类":g.type=c,$(".list_activities .box_a").eq(0).find("span").text(d);break;case"行业":g.industryId=c,$(".list_activities .box_a").eq(1).find("span").text(d);break;case"时间":g.time_status=c,$(".list_activities .box_a").eq(2).find("span").text(d);break;case"收费类型":g.freeType=c,$(".list_activities .box_a").eq(3).find("span").text(d)}a.act_list.act_list_data(g)},act_list_data:function(c){b.myLaunchActivity(c).then(function(b){return 0!=b.code?void alert(b.msg):($(b.rows).map(function(){var b=new query_activity_list(this);a.act_list.activity_list.push(b)}),void $(".sys-loading").removeClass("show_a"))},function(){console.log("获取活动列表数据失败")})}},a.act_list.act_list_data(g);var h=!0,i=new iScroll("wrapper",{vScrollbar:!1,doubleTapZoom:10,onScrollEnd:function(){this.y==this.maxScrollY&&h&&(h=!1,d(),$(".sys-loading").addClass("show_a"))}});a.$on("ngfinish",function(a){i.refresh()})}]).controller("sponsor_listController",["$scope","activity_data",function(a,b){function c(){setTimeout(function(){e=!0,++d.pageIndex,a.sponsor_list.sponsorship_re(d)},1500)}$(".mml_bottom").show(),$(".mml_bottom a").removeClass("bottom_act"),$(".mml_bottom a").eq(1).addClass("bottom_act"),$(".ds_poiu_a").removeClass("show_a"),$(".retreat_icon").removeClass("none"),$(".acr_poui_x span").on("click",function(){$(".acr_poui_x span").removeClass("ls"),$(this).addClass("ls")}),$(".asddf_poiu").on("click",function(){$(".menu_pup_p").toggleClass("show_a")}),$("input").focus(function(){$("footer").hide()}),$("input").blur(function(){$("footer").show()});var d={};d.pageIndex=1,d.pageSize=4,d.sort=0,d.industry_id="",a.sponsor_list={activitySupport_list:[],sp_sort:function(b,c){d.pageIndex=1,a.sponsor_list.activitySupport_list=[],1==c?d.sort=b:2==c&&($(".menu_pup_p").toggleClass("show_a"),b=0==b?"":b,d.industry_id=b),a.sponsor_list.sponsorship_re(d)},sponsorship_re:function(c){b.support_list(c).then(function(b){return 0!=b.code?void console.log(b.msg):($(b.rows).map(function(){var b=new sponsor_list(this);a.sponsor_list.activitySupport_list.push(b)}),void $(".sys-loading").removeClass("show_a"))},function(){console.log("赞助列表数据获取失败")})}};var e=!0,f=new iScroll("wrapper",{vScrollbar:!1,doubleTapZoom:10,onScrollEnd:function(){this.y==this.maxScrollY&&e&&(e=!1,c(),$(".sys-loading").addClass("show_a"))}});a.$on("ngfinish",function(a){f.refresh()}),a.sponsor_list.sponsorship_re(d)}]).controller("ticket_volume_listController",["$scope","activity_data",function(a,b){$(".mml_bottom a").removeClass("bottom_act"),$(".mml_bottom a").eq(3).addClass("bottom_act"),$(".ds_poiu_a").removeClass("show_a"),$(".retreat_icon").removeClass("none"),a.pload_p=!1,b.verifyUserLogin().then(function(b){0==b.code&&(a.pload_p=!0)},function(){console.log("验证失败")});var c={pageIndex:1,pageSize:100,filter:0};a.volume_list={v_data:[],over_data:[],TicketList:function(c,d){b.queryTicketList(c).then(function(b){return 0!=b.code?void console.log(b.msg):void $(b.info).map(function(){var b=new ticket_volume_list(this);3!=c.filter?a.volume_list.v_data.push(b):3==c.filter&&a.volume_list.over_data.push(b)})},function(){console.log("查看票卷数据失败")})},ticket_volume:function(b){$(".volume_button").hide(),$(".expired_ticket_volume").show(),c.filter=3,a.volume_list.TicketList(c)}},console.log(c),a.volume_list.TicketList(c)}]).controller("add_page_controller",["$scope","activity_data",function(a,b){$(".ds_poiu_a").removeClass("show_a"),$(".retreat_icon").removeClass("none"),$(".mml_bottom a").removeClass("bottom_act"),a.add_page={msg:function(){mui.alert("发起活动请到电脑端发起","E场景活动")}}}]).controller("loadController",["$scope","activity_data","$location","$stateParams",function(a,b,c,d){a.url=d.url,$("html,body").animate({scrollTop:0},200),$(".mml_bottom a").removeClass("bottom_act"),$(".mml_bottom a").eq(4).addClass("bottom_act"),$(".ds_poiu_a").removeClass("show_a"),$(".retreat_icon").removeClass("none"),$(".forget_in").on("click",function(){mui.alert("忘记密码请到PC端修改","E场景活动",function(){$("#account").focus()})}),a.load_ing={landing:function(){var c=$("#account").val(),d=$("#password").val();if(!form_mm.isnull(c))return void mui.alert("请输入手机号码","E场景活动",function(){$("#account").focus()});if(!form_mm.tel(c))return void mui.alert("手机号码格式错误","E场景活动",function(){$("#account").focus()});if(!form_mm.isnull(d))return void mui.alert("请输入密码","E场景活动",function(){$("#password").focus()});var e=a.decrypt_p.aesEncrypt(d,a.decrypt_p.aesKey,a.decrypt_p.ivStr),f={};f.user_phone=c,f.user_password=e,b.userLogin(f).then(function(a){return 0!=a.code?void mui.alert(a.msg,"E场景活动",function(){}):void window.history.back()},function(){mui.alert("登陆失败","E场景活动",function(){})})}},b.selectOne().then(function(b){return 0!=b.code&&b.code!=-1?void c.path("/loading"):void(null!=a.url?c.path(a.url):c.path("/personal_center"))},function(){console.log("获取用户信息失败")})}]).controller("registerController",["$scope","activity_data",function(a,b){$(".mml_bottom a").removeClass("bottom_act"),$(".mml_bottom a").eq(4).addClass("bottom_act"),$(".ds_poiu_a").removeClass("show_a"),$(".retreat_icon").removeClass("none");var c=!0,d=90,e=!0;a.register={verification_code:function(){var e=$("#rit_phone").val(),f=$("#valueCode").val();return form_mm.isnull(e)?form_mm.tel(e)?form_mm.isnull(f)?void(c&&c&&b.registerCode(e,f).then(function(b){if(0!=b)return void mui.alert(b.msg,"E场景活动",function(){$("#valueCode").focus(),a.register.replace()});c=!1;setInterval(function(){--d>0?$(".df_poiu_a").text(d).css({background:"#e0e0e0",width:"70px"}):(c=!0,clearTimeout(d),$(".df_poiu_a").css({background:"#4FA45D"}).text("获取验证码"))},1e3)},function(){mui.alert("短信验证发送失败","E场景活动",function(){$("#valueCode").focus()})})):void mui.alert("请输入图形验证码","E场景活动",function(){$("#valueCode").focus()}):void mui.alert("手机号码格式错误","E场景活动",function(){$("#rit_phone").focus()}):void mui.alert("请输入手机号码","E场景活动",function(){$("#rit_phone").focus()})},replace:function(){$(".verification_code").attr("src","/validateImageServlet?v="+(new Date).getTime())},register_event:function(){var a=$("#rit_phone").val(),c=$("#valueCode").val(),d=$("#rit_code").val(),f=$("#rit_pwd").val(),g=$("#rit_pwdT").val(),h={phone:a,rit_code:d,password:f};return form_mm.isnull(a)?form_mm.tel(a)?form_mm.isnull(c)?form_mm.isnull(d)?form_mm.isnull(f)?f.length<6?void mui.alert("密码不能小余6位","E场景活动",function(){$("#rit_pwd").focus()}):form_mm.isnull(g)?f!=g?void mui.alert("两次密码输入不一致","E场景活动",function(){$("#rit_pwdT").focus()}):($(".sys-loading").addClass("show_a"),void(e&&(b.doRegister(h).then(function(a){return e=!0,0!=a.code?($(".sys-loading").removeClass("show_a"),void mui.alert(a.msg,"E场景活动",function(){})):($(".sys-loading").removeClass("show_a"),void $location.path("personal_center"))},function(){mui.alert("注册失败","E场景活动",function(){e=!0})}),e=!1))):void mui.alert("请输入确认密码","E场景活动",function(){$("#rit_pwdT").focus()}):void mui.alert("请输入密码","E场景活动",function(){$("#rit_pwd").focus()}):void mui.alert("请输入短息验证码","E场景活动",function(){$("#rit_code").focus()}):void mui.alert("请输入图形验证码","E场景活动",function(){$("#valueCode").focus()}):void mui.alert("手机号码格式错误","E场景活动",function(){$("#rit_phone").focus()}):void mui.alert("请输入手机号码","E场景活动",function(){$("#rit_phone").focus()})}}}]).controller("loan_co",["$scope","activity_data","$location","$stateParams",function(a,b,c,d){a.activity_id=d.activity_id,a.answerPup=function(){var c=$(".loan_name").val(),d=$(".loan_tel").val(),e=parseFloat($(".loan_money").val()),f=$(".loan_remark").val(),g=$("#sex1").is(":checked")?1:2,h=parseInt($("#showUserPicker").text()),i=($(".activity_id").val(),{name:c,sex:g,phone:d,apply_money:e,contact_status:1,user_remark:f,periods:h,activity_id:a.activity_id});return form_mm.isnull(c)?form_mm.tel(d)?isNaN(e)?(mui.alert("贷款金额不能为空"),void $(".loan_money").focus()):e<=0?(mui.alert("贷款金额不能小于0"),void $(".loan_money").focus()):isNaN(h)?(mui.alert("请选择还款期数"),void $("#showUserPicker").focus()):void b.loan_money(i).then(function(a){return 0!=a.code?void mui.alert(a.msg):(mui.alert("申请成功！\n工作人员近期会和您取的联系！"),void $(".now_check").text("待审核").css({background:"rgba(0,0,0,.2)"}).unbind("click"))},function(){mui.alert("验证失败")}):(mui.alert("手机号码格式错误"),void $(".loan_tel").focus()):(mui.alert("姓名不能为空"),void $(".loan_name").focus())},a.showAnswer=function(){$(".answer_wrap").css("display","block")},a.divideMoney=function(){!function(a,b){a.init(),a.ready(function(){var a=new mui.PopPicker;a.setData([{value:"1",text:"1期"},{value:"3",text:"3期"},{value:"6",text:"6期"},{value:"12",text:"12期"},{value:"24",text:"24期"},{value:"36",text:"36期"}]),a.show(function(a){document.getElementById("showUserPicker").innerHTML=a[0].text})})}(mui,document)}}]).controller("personal_center",["$scope","activity_data","$location",function(a,b,c){$(".mml_bottom a").removeClass("bottom_act"),$(".mml_bottom a").eq(4).addClass("bottom_act"),$(".ds_poiu_a").removeClass("show_a"),$(".retreat_icon").removeClass("none"),mui.previewImage();var d=!0;a.pe_er={user_icon_o:{},logged_out:function(){b.clear_cookie().then(function(a){c.path("/index")},function(){console.log("退成登录失败")})},modify_data:function(){var e=$("#nickname").val(),f=$("#sex_may").val(),g=$("#industry_id").val(),h=$("#signature").val(),i=a.pe_er.user_icon_o.user_id;d&&(b.updateUserInfo_to(i,e,f,g,h).then(function(a){d=!0,1==a.code&&(c.path("personal_center"),$(".sys-loading").removeClass("show_a"))},function(){console.log("修改密码失败")}),d=!1)},feedback:function(){var a=$(".suggestion_feedback").val();return form_mm.isnull(a)?void b.add_feedback(a).then(function(a){return 1!=a.code?void mui.alert("意见反馈提交失败","E场景活动"):(mui.alert("意见反馈提交成功","E场景活动",function(){c.path("/loading")}),void c.path("/loading"))},function(){console.log("意见反馈提交失败")}):(mui.alert("意见反馈信息不能为空"),void $(".suggestion_feedback").focus())}},b.selectOne().then(function(b){return 0!=b.code&&b.code!=-1?void c.path("/loading"):void(a.pe_er.user_icon_o=new user_info(b.info))},function(){console.log("获取用户信息失败")}),b.getDatas("GET","/sponsor/get_sponsorapply").then(function(b){0==b.code&&1==b.info.status?a.sponsorStatus=!0:(a.sponsorStatus=!1,c.path("/loading"))})}]).controller("change_passwordController",["$scope","activity_data","$location","$stateParams",function(a,b,c,d){$(".mml_bottom a").removeClass("bottom_act"),$(".mml_bottom a").eq(4).addClass("bottom_act"),$(".ds_poiu_a").removeClass("show_a"),$(".retreat_icon").removeClass("none");var e=(d.user_id,!0);a.password=function(){var a=$("#rit_pwd").val(),d=$("#rit_pwdT").val(),f=$("#new_pwd").val();if(!form_mm.isnull(f))return void mui.alert("请输入原始密码","E场景活动",function(){$("#rit_pwd").focus()});if(!form_mm.isnull(a))return void mui.alert("请输入密码","E场景活动",function(){$("#rit_pwd").focus()});if(a.length<6)return void mui.alert("密码不能小余6位","E场景活动",function(){$("#rit_pwd").focus()});if(!form_mm.isnull(d))return void mui.alert("请输入确认密码","E场景活动",function(){$("#rit_pwdT").focus()});if(a!=d)return void mui.alert("两次密码输入不一致","E场景活动",function(){$("#rit_pwdT").focus()});if(e){$(".sys-loading").addClass("show_a");var g={};g.new_pwd=d,g.old_pwd=f,b.updateUserInfo(g).then(function(a){return e=!0,$(".sys-loading").removeClass("show_a"),0!=a.code?void mui.alert(a.msg,"E场景活动",function(){}):void mui.alert(a.msg,"E场景活动",function(){c.path("personal_center")})},function(){console.log("修改密码失败")}),e=!1}}}]).controller("my_activities_controller",["$scope","activity_data","$location","$stateParams",function(a,b,c,d){$(".mml_bottom a").removeClass("bottom_act"),$(".mml_bottom a").eq(4).addClass("bottom_act"),$(".ds_poiu_a").removeClass("show_a"),$(".retreat_icon").removeClass("none");var e={pageIndex:1,pageSize:10,user_id:d.user_id,time_status:"",flag:"1",type:"0"},f=!0,g=d.type;a.type_p=d.type,$(".sys-loading").addClass("show_a"),$(".act_use_p a").on("click",function(){$(".act_use_p a").removeClass("cat_poo"),$(this).addClass("cat_poo")}),a.my_activities={activity_list:[],participant:function(c){b.myTakePartInActivity(c).then(function(b){return $(".sys-loading").removeClass("show_a"),0!=b.code?void mui.alert(b.msg,"E场景活动",function(){window.location.href="/#/loading"}):(f=!0,void $(b.rows).map(function(){var b=new query_activity_list(this);b.order_id=this.order_id,a.my_activities.activity_list.push(b)}))},function(){console.log("活动我的活动失败")})},category:function(b){switch($(".sys-loading").addClass("show_a"),e.pageIndex=1,e.time_status=b,a.my_activities.activity_list=[],g=parseInt(g)){case 1:a.my_activities.participant(e);break;case 2:a.my_activities.collection(e);break;case 3:a.my_activities.enshrine(e)}},promotional_activities:function(){setTimeout(function(){switch(++e.pageIndex,g=parseInt(g)){case 1:a.my_activities.participant(e);break;case 2:a.my_activities.collection(e);break;case 3:a.my_activities.enshrine(e)}},1e3)},collection:function(c){b.myLaunchActivity(c).then(function(b){return $(".sys-loading").removeClass("show_a"),0!=b.code?void mui.alert(b.msg,"E场景活动",function(){window.location.href="/#/loading"}):(f=!0,void $(b.rows).map(function(){var b=new query_activity_list(this);a.my_activities.activity_list.push(b)}))},function(){console.log("活动我的活动失败")})},enshrine:function(c){b.myAtteActivityData(c).then(function(b){return 0!=b.code?void mui.alert(b.msg,"E场景活动",function(){window.location.href="/#/loading"}):($(".sys-loading").removeClass("show_a"),f=!0,void $(b.rows).map(function(){var b=new query_activity_list(this);a.my_activities.activity_list.push(b)}))},function(){console.log("活动我的活动失败")})}};var h=new iScroll("wrapper",{vScrollbar:!1,doubleTapZoom:10,onScrollEnd:function(){this.y==this.maxScrollY&&f&&(f=!1,$(".sys-loading").addClass("show_a"),a.my_activities.promotional_activities())}});switch(a.$on("ngfinish",function(a){h.refresh()}),g){case"1":$(".user_ad_top a").removeClass("act_a"),$(".user_ad_top a").eq(0).addClass("act_a"),e.pageIndex=1,e.time_status=0,g=1,a.my_activities.activity_list=[],a.my_activities.participant(e),$(".user_act_pii").removeClass("user_act_pii_p");break;case"2":$(".user_ad_top a").removeClass("act_a"),$(".user_ad_top a").eq(1).addClass("act_a"),e.pageIndex=1,e.time_status=0,g=2,a.my_activities.activity_list=[],a.my_activities.collection(e),$(".user_act_pii").addClass("user_act_pii_p");break;case"3":$(".user_ad_top a").removeClass("act_a"),$(".user_ad_top a").eq(2).addClass("act_a"),e.pageIndex=1,e.time_status=0,g=3,a.my_activities.activity_list=[],a.my_activities.enshrine(e),$(".user_act_pii").addClass("user_act_pii_p")}}]).controller("sponsorship_detailsController",["$scope","activity_data","$location","$stateParams","act_date",function(a,b,c,d,e){a.type=d.type,a.user_id=d.user_id;var f={pageIndex:1,pageSize:10,status:"",user_id:a.user_id,filter:"",timeStatus:""},g=!0;switch($(".act_use_p a").on("click",function(){$(".act_use_p a").removeClass("cat_poo"),$(this).addClass("cat_poo")}),$(".user_ad_top  a").on("click",function(){$(".user_ad_top  a").removeClass("act_a"),$(this).addClass("act_a")}),a.sponsorship={sp_list:[],project_sponsor:function(c){$(".user_ad_top  a").removeClass("act_a").eq(0).addClass("act_a"),b.my_launch_support(c).then(function(b){0==b.code&&($(b.rows).map(function(){var b=new sponsorship_details(this);a.sponsorship.sp_list.push(b)}),g=!0,$(".sys-loading").removeClass("show_a"))},function(){console.log("获取赞助失败")})},friendly:function(c){$(".user_ad_top  a").removeClass("act_a").eq(1).addClass("act_a"),b.my_takein_support(c).then(function(b){0==b.code&&($(b.rows).map(function(){var b=new sponsorship_details(this);a.sponsorship.sp_list.push(b)}),g=!0,$(".sys-loading").removeClass("show_a"))},function(){console.log("获取赞助失败")})},sponsored_title:function(b){a.type=b,a.sponsorship.status("",b)},status:function(b){a.sponsorship.sp_list=[],f.pageIndex=1,f.status=b,1==a.type?a.sponsorship.project_sponsor(f):2==a.type?(6==b||7==b?(f.timeStatus="",f.filter=b):5==b&&(f.filter="",f.timeStatus=2),a.sponsorship.friendly(f)):3==a.type&&(a.sponsorship.sp_list=[],1==f.pageIndex)},refresh:function(){++f.pageIndex,1==a.type?a.sponsorship.project_sponsor(f):a.sponsorship.friendly(f)},deteail_a:function(a){e.set_act_date(a),c.path("sponsorship_payment")}},a.type){case"1":a.sponsorship.project_sponsor(f);break;case"2":a.sponsorship.friendly(f);break;case"3":a.sponsorship.sp_list=[],1==f.pageIndex,$(".user_ad_top  a").removeClass("act_a").eq(2).addClass("act_a")}var h=new iScroll("wrapper",{vScrollbar:!1,doubleTapZoom:10,onScrollEnd:function(){this.y==this.maxScrollY&&g&&(g=!1,a.sponsorship.refresh(),$(".sys-loading").addClass("show_a"))}});a.$on("ngfinish",function(a){h.refresh()})}]).controller("my_sponsorship_detailsController",["$scope","activity_data","$location","$stateParams",function(a,b,c,d){var e=d.id,f={activity_support_id:e,peo_num:"",pageSize:25,pageIndex:1};a.my_sponsorship={money:d.money,peo_num:d.peo_num,data_array:[],particulars:function(c){b.takein_detail(c).then(function(b){0==b.code&&($(b.rows).map(function(){var b=new takein_detail(this);a.my_sponsorship.data_array.push(b)}),console.log(a.my_sponsorship.data_array))},function(){console.log("获取赞助详情失败")})}},a.my_sponsorship.particulars(f)}]).controller("sponsorship_paymentController",["$scope","activity_data","$location","$stateParams","act_date",function(a,b,c,d,e){a.act_d=e.date,console.log(a.act_d)}]).controller("volume_details_Controller",["$scope","activity_data","$location","$stateParams",function(a,b,c,d){a.volume_details={data_p:[],dat_po:{},details_a:function(c){b.query_consumption_user_list(c).then(function(b){return 0!=b.code?void mui.alert(b.msg,"E场景活动"):(a.volume_details.dat_po.results=b.results,a.volume_details.dat_po.already_sign=b.otherinfo.already_sign,a.volume_details.dat_po.not_sign=b.otherinfo.not_sign,void $(b.rows).map(function(){var b=new query_consumption_user_list(this);a.volume_details.data_p.push(b)}))},function(){console.log("获取活动详情失败")})}},a.volume_details.details_a({pageIndex:1,activity_id:d.id,pageSize:"500"})}]).controller("my_whiteController",["$scope","activity_data","$location","$stateParams",function(a,b,c,d){var e=d.type,f=!0,g={user_id:d.user_id,pageIndex:1,pageSize:"10",contact_status:"1"};a.ious_p={date_arr:[],date_pio:function(c){b.query_page_p(c).then(function(b){return 0!=b.code?void mui.alert(b.msg,"E场景活动"):(f=!0,$(".sys-loading").removeClass("show_a"),void $(b.rows).map(function(){var b=new query_page(this);a.ious_p.date_arr.push(b)}))},function(){console.log("获取白条信息失败")})},iou_state:function(b){g.pageIndex=1,a.ious_p.date_arr=[],g.contact_status=b,a.ious_p.date_pio(g)}},g.contact_status=e,$(".user_poi p").removeClass("act_p_o"),$(".user_poi p").eq(e-1).addClass("act_p_o"),a.ious_p.date_pio(g);var h=new iScroll("wrapper",{vScrollbar:!1,doubleTapZoom:10,onScrollEnd:function(){this.y==this.maxScrollY&&f&&(f=!1,$(".sys-loading").addClass("show_a"),++g.pageIndex,a.ious_p.date_pio(g))}});a.$on("ngfinish",function(a){h.refresh()}),$(".user_poi p").on("click",function(){$(".user_poi p").removeClass("act_p_o"),$(this).addClass("act_p_o")})}]).controller("review_detailsController",["$scope","activity_data","$location","$stateParams",function(a,b,c,d){a.review=d;var e=["","/img/examine_a.png","/img/examine_b.png","/img/examine_c.png","/img/examine_d.png"];a.review.img_src=e[a.review.contact_status]}]).controller("activity_hotr",["$scope","activity_data","$location","$stateParams",function(a,b,c,d){a.dte=[],b.getActivityHot().then(function(b){return 0!=b.code?void mui.alert(b.msg,"E场景活动"):void $(b.info).map(function(){var b=new preferential(this);a.dte.push(b)})},function(){console.log("获取热门活动失败")}),a.down_po=function(){alert(2),/Android|webOS|BlackBerry|SymbianOS/i.test(navigator.userAgent)?window.open("http://resource.apptown.cn/app/app.apk"):window.open("https://itunes.apple.com/cn/app/e-chang-jing-huo-dong/id1110240836?mt=8&uo=4")}}]).controller("sponsor_authCtrl",["$scope","activity_data","$stateParams",function(a,b,c){var d=a;d.sponsor={},d.status={editForm:!1,success:!1,fail:!1,waiting:!1},b.getDatas("GET","/sponsor/get_sponsorapply").then(function(a){if(null==a.info)return d.status.editForm=!0,!1;if(0==a.code&&a.info.status)switch(Number(a.info.status)){case 1:d.status.success=!0,d.sponsor=a.info;break;case 2:d.status.fail=!0,d.sponsor.failInfo=a.info.remark;break;case 3:d.status.waiting=!0}}),a.sponsorAuthForm=function(){return form_mm.isnull(d.sponsor.name)?form_mm.isnull(d.sponsor.contacter)?form_mm.isnull(d.sponsor.contacter_phone)?form_mm.tel(d.sponsor.contacter_phone)?form_mm.isnull(d.sponsor.introduction)?d.sponsor.introduction.length>150?void mui.alert("主办方简介不能超过150字","E场景活动",function(){}):void b.getDatas("POST","/sponsor/add_or_update_apply_sponsor",d.sponsor).then(function(a){0==a.code?(d.status.editForm=!1,d.status.waiting=!0):mui.alert(a.msg,"E场景活动",function(){})}):void mui.alert("请输入主办方简介","E场景活动",function(){}):void mui.alert("主办方联系方式格式错误","E场景活动",function(){}):void mui.alert("请输入主办方联系方式","E场景活动",function(){}):void mui.alert("请输入主办方联系人","E场景活动",function(){}):void mui.alert("请输入主办方单位名称","E场景活动",function(){})},a.reSponsorAuth=function(){d.status.editForm=!0,d.status.fail=!1}}]).controller("activity_show_ticket",["$scope","activity_data","$location","$stateParams",function(a,b,c,d){var e={id:3};a.type_p,a.is_vote,b.query_vote_p(e).then(function(b){return 0!=b.code?void mui.alert(b.msg):(a.vote_detail=new query_vote(b.info),a.type_p=b.info.type,void(a.is_vote=b.info.is_vote))},function(){console.log("投票详情查询失败")}),$(document).on("click",".about_vote_content label",function(){var a=$("#type_p").val();1==a?($(".about_vote_content label").css("background-position","-26px -1119px").removeAttr("data-i"),$(this).css("background-position","-26px -1160px").attr("data-i",2)):2==a&&(1==$(this).attr("data-i")?($(this).css("background-position","-26px -1160px"),
$(this).attr("data-i",2)):($(this).css("background-position","-26px -1119px"),$(this).attr("data-i",1)))}),$(".vote_comfirm").on("click",function(){var a="",c=[];$(".about_vote_content label").map(function(){2==$(this).attr("data-i")&&(a+="_"+$(this).attr("data-id"),c.push($(this).parents(".about_vote_list")))});var d={ids:a.substring(1)};b.query_vote_do(d).then(function(a){if(0!=a.code)return void mui.alert(a.msg);0==a.code&&($(".about_vote_tip").css("display","block"),setTimeout(function(){$(".about_vote_tip").css("display","none")},1500));for(var b=0;b<c.length;b++){var d=$(c[b]).find(".vote_me").attr("data-tk");$(c[b]).find(".vote_me").text(++d+"票")}},function(){console.log("执行投票失败")})})}]),angular.module("act_details",["directive_mml","activity_servrt","ui.router","pay","sponsor"]).controller("activity_detail_c",["$scope","activity_data","$location","$stateParams","act_date",function(a,b,c,d,e){$(".mml_bottom ").hide(),a.id=d.id;var f=!0;a.detail={detail_date:{},detail_f:function(c){b.activity_detail(c).then(function(d){if(0!=d.code)return void mui.alert("活动详情数据获取失败","E场景活动");a.detail.detail_date=new activity_detail(d.info),a.detail.detail_date.act_id=a.id,e.set_act_date(a.detail.detail_date),a.industry=a.classify[1].maker_title[a.detail.detail_date.industry_id].name;var f=new RegExp("\n","g"),g=removeHTMLTag(a.detail.detail_date.details).replace(f,"").substring(0,100),h={};h.title=a.detail.detail_date.name,h.desc=g,h.link=window.location.href,h.imgUrl="http://m.apptown.cn/img/activity/share/share_activity1.jpg",wx_share(h,function(){$("#qrcode").on("click",function(){b.getDatas("get","/shareImage/get_share_image_url?activityId="+c).then(function(a){wx.previewImage({current:a.msg,urls:[a.msg]})})})})},function(){console.log("活动详情获取失败")})},collection:function(){var c={};c.activity_id=a.id,c.type=1,1==a.detail.detail_date.is_collect&&(f=!1),f?b.exec_attention(c).then(function(a){return 0!=a.code?void mui.alert(a.msg,"E场景活动"):($(".collection_p").toggleClass("ls"),void(f=!1))},function(){console.log("请求取消收藏接口失败")}):b.cancel_attention(c).then(function(a){return 0!=a.code?void mui.alert(a.msg,"E场景活动"):($(".collection_p").toggleClass("ls"),void(f=!1))},function(){console.log("请求收藏接口失败")})},sign_up_p:function(a,b){b==-1&&(c.path("loading"),mui.alert("请登录！","E场景活动",function(){$("html,body").animate({scrollTop:0},200)})),0==b&&(0==a?c.path("activity_sign_ree"):1==a&&c.path("activity_charge"))},sp_date:function(a){0!=a&&c.path("sp_details/"+a)}},$(window).scrollTop(5),a.sharep_a=new share_p,a.detail.detail_f(a.id);var g=new Swiper(".banner_top_b_banner",{autoplay:3e3,observer:!0,observeParents:!0,pagination:".swiper-pagination",paginationClickable:!0}),g=new Swiper(".swiper-container-act",{direction:"vertical",longSwipesRatio:.01,onSlideChangeEnd:function(a){1==g.activeIndex&&$(window).scrollTop(5)}}),h={};h.render="canvas",h.text="http://www.apptown.cn/scan/scanActivityCode?activityId="+a.id,h.width="200",h.height="200",$(".act_qc_im").qrcode(h);var i=$(".act_tble_a").offset().top;setTimeout(function(){$(window).scrollTop(5)},3e3),$(window).scroll(function(){$(this).scrollTop()<5?$(".swiper-container-act").show():$(".swiper-container-act").hide(),i<=$(this).scrollTop()-100?$(".act_tble_a").css({position:"fixed",top:"-10px",width:"100%"}):$(".act_tble_a").removeAttr("style")})}]).controller("activity_deta_date",function(a,b){$(".act_tble_a .zd").removeClass("act_poi"),$(".act_tble_a .zd").eq(0).addClass("act_poi"),$(".progress_of").css({left:"0%"})}).controller("activity_registration_number",function(a,b){var c={};c.activity_id=a.id,c.pageIndex=1,c.pageSize=10,a.enrollment_list={sign_up:[],paging:function(b){c.pageIndex++,a.enrollment_list.list_date(c)},list_date:function(c){b.consumption_list(c).then(function(b){return 0!=b.code?void mui.alert("获取报名数据失败","E场景活动"):($(b.rows).map(function(){var b=new activity_id_by_consumption_list(this);a.enrollment_list.sign_up.push(b)}),void(b.rows.length<10&&$(".paging_list").hide()))},function(){console.log("获取报名数据失败")})}},a.enrollment_list.list_date(c),$(".act_tble_a .zd").removeClass("act_poi"),$(".act_tble_a .zd").eq(1).addClass("act_poi"),$(".progress_of").css({left:"33.3%"})}).controller("activity_message",function(a,b,c){var d={};d.pageIndex=1,d.pageSize=100,d.source_id=a.id,a.leave_message={me_txt_length:"",message_date:[],message_p:function(c){b.comment_list(c).then(function(b){return 0!=b.code?void mui.alert(b.msg,"E场景活动"):void $(b.rows).map(function(){var b=new comment_list_f(this);a.leave_message.message_date.push(b)})},function(){console.log("获取报名数据失败")})},message:function(b){a.me_id=b,mui("#message").popover("toggle"),$(".me_text_area").focus()},add_comment_data:function(a){b.add_comment_data(a).then(function(a){return 0!=a.code?(mui("#message").popover("toggle"),c.path("loading"),void mui.alert(a.msg,"E场景活动")):(mui("#message").popover("toggle"),void location.reload())},function(){console.log("插入留言失败")})},comment:function(b){var c={};0==a.me_id?c.source_id=a.id:c.superior=a.me_id,c.comment_type=1,c.comment_content=$(".me_text_area").val(),this.add_comment_data(c)}},a.leave_message.message_p(d),$(".me_text_area").val(""),$(".act_tble_a .zd").removeClass("act_poi"),$(".act_tble_a .zd").eq(2).addClass("act_poi"),$(".progress_of").css({left:"66.6%"})}).controller("activity_sign_ree_c",["$scope","activity_data","$location","$stateParams","act_date",function(a,b,c,d,e){return a.act_d=e.date,0==a.act_d?void window.history.back():(a.form_p=a.act_d.detail_config,a.id=a.act_d.act_id,a.img_p=a.act_d.images_po[0],a.title=a.act_d.title,void(a.form_te={submit:function(){for(var c={},d=0;d<$(".form_po_ipnut").length;d++){var e=$(".form_po_ipnut").eq(d).attr("data-is");if("y"==e&&!form_mm.isnull($(".form_po_ipnut").eq(d).val()))return mui.alert("请输入"+$(".form_po_ipnut").eq(d).attr("placeholder"),"E场景活动"),void $(".form_po_ipnut").eq(d).focus()}return form_mm.tel($(".form_po_ipnut").eq(1).val())?(c.name=$(".form_po_ipnut").eq(0).val(),c.tel=$(".form_po_ipnut").eq(1).val(),$(".form_po_ipnut").map(function(a){if(a>1){var b=$(this).attr("data-yu");c[b]=$(this).val()}}),void b.add_consumption(a.id,c).then(function(a){return 0!=a.code?void mui.alert(a.msg,"E场景活动"):void mui.alert("报名成功","E场景活动",function(){window.history.back()})},function(){console.log("报名失败")})):void mui.alert("电话号码格式输入错误","E场景活动")}}))}]).controller("activity_charge_p",["$scope","activity_data","$location","$stateParams","act_date","$state",function(a,b,c,d,e,f){return $(".mml_bottom ").hide(),a.ticket=1,a.act_d=e.date,a.form_p=a.act_d.detail_config,0==a.act_d.the_price?void window.history.back():0==a.act_d?void window.history.back():(a.charge={the_price:0,selected:0,ticket_id:0,play:1,add_charge:function(b){1==b&&a.ticket<10?a.ticket++:0==b&&a.ticket>1&&a.ticket--,this.the_price=this.selected*a.ticket},act_list:function(b,c,d){$(".df_pooiiuu_s .mui-hidden").removeClass("show_a"),$(".df_pooiiuu_s").eq(b).find(".mui-hidden").addClass("show_a"),this.selected=c,this.the_price=this.selected*a.ticket,this.ticket_id=d},we_pay_oi:function(a){this.play=a,$(".we_pay_oi .mui-hidden").removeClass("show_a"),$(".we_pay_oi").eq(a).find(".mui-hidden").addClass("show_a")},act_pay:function(){var c={},d={};if(d.ticket_id=this.ticket_id,0==d.ticket_id)return void mui.alert("请选择票种","E场景活动");for(var g=0;g<$(".form_po_ipnut").length;g++){var h=$(".form_po_ipnut").eq(g).attr("data-is");if("y"==h&&!form_mm.isnull($(".form_po_ipnut").eq(g).val()))return mui.alert("请输入"+$(".form_po_ipnut").eq(g).attr("placeholder"),"E场景活动"),void $(".form_po_ipnut").eq(g).focus()}if(!form_mm.tel($(".form_po_ipnut").eq(1).val()))return void mui.alert("电话号码格式输入错误","E场景活动");c.name=$(".form_po_ipnut").eq(0).val(),c.tel=$(".form_po_ipnut").eq(1).val(),$(".form_po_ipnut").map(function(a){if(a>1){var b=$(this).attr("data-yu");c[b]=$(this).val()}});var i={};i.conDetails=c,i.consumption=d,i.quantity=a.ticket,console.log(i);var j={};if(j.id=a.act_d.act_id,j.title=a.act_d.title,j.the_price=a.charge.the_price,j.date=i,j.play=this.play,0==this.play){j.type="e币支付",e.set_act_date(j);var k=["确认","取消"];mui.confirm("请确认购买信息无误，提交之后无法修改","E场景活动",k,function(a){0==a.index&&(f.go("e_money_pay"),$(".sys-loading").addClass("show_a"))})}else if(1==this.play){if(0==a.charge.selected)return void mui.alert("0元票种请选择e币支付！","E场景活动");i.channel=3,b.charge_consumption(i).then(function(a){if(0!=a.code)return void alert(a.msg);var b=new wx_coi(a.info);onBridgeReady(b,function(){mui.alert("支付成功！","E场景活动")})},function(){console.log("报名失败")})}}},void $("html,body").animate({scrollTop:0},200))}]).controller("sp_details",["$scope","activity_data","$location","$stateParams","act_date","anchorScroll","$sce",function(a,b,c,d,e,f,g){$(".mml_bottom ").hide();var h=d.id;a.id=h,a.sp_detail={sp_data:{},sp_aj:function(){b.getDatas("get","/support/support_detail?supportid="+h).then(function(c){a.sp_detail.sp_data=new sponsorDetail(c.info),a.industry=a.classify[1].maker_title[a.sp_detail.sp_data.industry_id].name;var d=new RegExp("\n","g"),e=removeHTMLTag(a.sp_detail.sp_data.content_details).replace(d,"").substring(0,100),f={};f.title=a.sp_detail.sp_data.name,f.desc=e,f.link=window.location.href,f.imgUrl="http://m.apptown.cn/img/activity/share/share_activity1.jpg",wx_share(f,function(){$("#qrcode").on("click",function(){b.getDatas("get","/shareImage/get_share_image_url?activityId="+h).then(function(a){wx.previewImage({current:a.msg,urls:[a.msg]})})})})})},to_sponsor:function(b,d){if(0==a.sp_detail.sp_data.login_user)return c.path("loading"),void mui.alert("用户未登录！","E场景活动");var f={};f.name=a.sp_detail.sp_data.name,f.cover=a.sp_detail.sp_data.poster[0],f.industry=a.industry,f.sponsor_name=a.sp_detail.sp_data.sponsor_name,f.sponsor_phone=a.sp_detail.sp_data.sponsor_phone,f.repay_content=b,f.id=d,e.set_act_date(f),c.path("sponsorship_return")},sponsor_poi:function(){return 0==a.sp_detail.sp_data.login_user?(c.path("loading"),void mui.alert("用户未登录！","E场景活动")):void f.toView("#sponsor_poi",!0)}},a.sharep_a=new share_p(h);var i=(new Swiper(".banner_top_b_banner",{autoplay:3e3,observer:!0,observeParents:!0,pagination:".swiper-pagination",paginationClickable:!0}),$(".act_tble_a").offset().top);$(window).scroll(function(){i<=$(this).scrollTop()-100?$(".act_tble_a").css({position:"fixed",top:"-10px",width:"100%"}):$(".act_tble_a").removeAttr("style")}),a.sp_detail.sp_aj()}]).controller("sponsorship_deta_date",function(a,b){$(".act_tble_a .zd").removeClass("act_poi"),$(".act_tble_a .zd").eq(0).addClass("act_poi"),$(".progress_of").css({left:"0%"})}).controller("sponsorship_participate",function(a,b){$(".act_tble_a .zd").removeClass("act_poi"),$(".act_tble_a .zd").eq(1).addClass("act_poi"),$(".progress_of").css({left:"33%"});var c={};c.pageIndex=1,c.pageSize=10,c.activity_support_id=a.id,a.sppr={s_date_t:[],participate:function(c){b.takein_detail(c).then(function(b){return 0!=b.code?void mui.alert(b.msg,"E场景活动"):void $(b.rows).map(function(){var b=new timestamp_p(this);a.sppr.s_date_t.push(b)})},function(){mui.alert("获取参与人数数据失败","E场景活动")})},paging_a:function(){c.pageIndex++,a.sppr.participate(c)}},a.sppr.participate(c)}).controller("sponsor_message",function(a,b,c){var d={};d.pageIndex=1,d.pageSize=100,d.source_id=a.id,a.leave_message={me_txt_length:"",message_date:[],message_p:function(c){b.comment_list(c).then(function(b){return 0!=b.code?void mui.alert(b.msg,"E场景活动"):void $(b.rows).map(function(){var b=new comment_list_f(this);a.leave_message.message_date.push(b)})},function(){console.log("获取报名数据失败")})},message:function(b){a.me_id=b,mui("#message").popover("toggle"),$(".me_text_area").focus()},add_comment_data:function(a){b.add_comment_data(a).then(function(a){return 0!=a.code?(mui("#message").popover("toggle"),c.path("loading"),void mui.alert(a.msg,"E场景活动")):(mui("#message").popover("toggle"),void location.reload())},function(){console.log("插入留言失败")})},comment:function(b){var c=$(".me_text_area").val().trim();if(!form_mm.isnull(c))return void mui.alert("留言不能为空","E场景活动",function(){$(".me_text_area").focus()});var d={};0==a.me_id?d.source_id=a.id:d.superior=a.me_id,d.comment_type=1,d.comment_content=$(".me_text_area").val(),this.add_comment_data(d)}},a.leave_message.message_p(d),$(".act_tble_a .zd").removeClass("act_poi"),$(".act_tble_a .zd").eq(2).addClass("act_poi"),$(".progress_of").css({left:"66%"})}).controller("sponsorship_return",["$scope","activity_data","$location","$stateParams","act_date",function(a,b,c,d,e){return a.date_p=e.date,$("html,body").animate({scrollTop:0},200),0==a.date_p?void window.history.back():void(a.ticket_types={number_of:1,add_poi:function(a){1==a&&this.number_of<10?this.number_of++:2==a&&this.number_of>1&&this.number_of--},submit:function(){var c=$("#name").val().trim(),d=$("#tel").val().trim(),e=$("#address").val().trim();if(!form_mm.isnull(c))return void mui.alert("请输入姓名","E场景活动",function(){$("#name").focus()});if(!form_mm.isnull(d))return void mui.alert("请输入电话","E场景活动",function(){$("#tel").focus()});var f={},g={};g.name=c,g.tel=d,g.address=e,f.num=this.number_of,f.number_of=a.id,f.repay_from=form_date,b.query_sponsor_repay(datePiu).then(function(a){if(0!=a.code)return void alert(a.msg);var b=new wx_coi(a.info);console.log(b+"2222"),onBridgeReady(b,function(){mui.alert("支付成功！","E场景活动")})},function(){console.log("报名失败")})}})}]),angular.module("pay",["directive_mml","activity_servrt","ui.router"]).controller("e_money_pay",["$scope","activity_data","$location","$stateParams","act_date",function(a,b,c,d,e){return a.act_d=e.date,$(".sys-loading").removeClass("show_a"),0==a.act_d?void window.history.back():void(a.pay={sum:function(c){$(".sys-loading").addClass("show_a"),b.pay_consumption(a.act_d.date).then(function(b){if(0!=b.code)return void mui.alert(b.msg,"E场景活动");$(".sys-loading").removeClass("show_a");var c={};c.id=a.act_d.id,mui.alert("支付成功","E场景活动",function(){window.location.href="/html/index.html#/my_activities/1/"})},function(){mui.alert("e币支付请求后台失败","E场景活动")})}})}]),angular.module("sponsor",["directive_mml","activity_servrt","ui.router"]).controller("promotional_act_controller",["$scope","activity_data","$location","$stateParams","act_date",function(a,b,c,d,e){$(".ds_poiu_a").removeClass("show_a"),$(".retreat_icon").removeClass("none");var f=$.parseJSON(localStorage.input_f);input_val(f.activity),a.promotional={initiate:function(a){var d=da_input(1);void 0!=d&&b.simple_create_activity(d).then(function(a){return a.code==-10?(c.path("loading"),void mui.alert(a.msg,"E场景活动")):0!=a.code?void mui.alert(a.msg,"E场景活动"):(c.path("/activity_detail/"+a.info),$(".sys-loading").removeClass("show_a"),void mui.alert("活动发布成功","E场景活动",function(){}))},function(){mui.alert("发起活动请求后台失败","E场景活动")})}};var g=new mui.DtPicker,h=new mui.PopPicker({layer:[2]}),i=new mui.PopPicker,j=new mui.PopPicker,k=classify_p();h.setData(cityData),i.setData(k[0].maker_title),j.setData(k[1].maker_title),$(".time").on("tap",function(){var a=$(this);g.show(function(b){$(a).val(b.text)})}),$(".cat_poiu").on("tap",function(){var a=$(this);h.show(function(b){$(a).val(b[0].text+b[1].text),$(a).attr("data-id",b[1].id)})}),$(".select_po").on("tap",function(){var a=$(this);i.show(function(b){$(a).val(b[0].text),$(a).attr("data-id",b[0].id)})}),$(".select_po_p").on("tap",function(){var a=$(this);j.show(function(b){$(a).val(b[0].text),$(a).attr("data-id",b[0].id)})}),$("input,textarea").focus(function(){$(".mml_bottom").hide()}),$("input,textarea").blur(function(){$(".mml_bottom").show()})}]).controller("custom_form_controller",["$scope","activity_data","$location","$stateParams","act_date",function(a,b,c,d,e){}]).controller("sponsorship_controller",["$scope","activity_data","$location","$stateParams","act_date",function(a,b,c,d,e){}]).controller("sponsorship_rewards_controller",["$scope","activity_data","$location","$stateParams","act_date",function(a,b,c,d,e){}]),window.onunload=function(){localStorage.input_f=JSON.stringify(da_input(2))};